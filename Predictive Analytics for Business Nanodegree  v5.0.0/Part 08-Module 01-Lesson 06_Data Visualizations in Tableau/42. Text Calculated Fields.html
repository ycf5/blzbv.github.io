<!-- udacity2.0 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Text: Calculated Fields</title>
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/plyr.css">
  <link rel="stylesheet" href="../assets/css/katex.min.css">
  <link rel="stylesheet" href="../assets/css/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/udacimak.png" />
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar">
  <div class="sidebar-header">
    <h3>Data Visualizations in Tableau</h3>
  </div>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled components">
    <li class="">
      <a href="01. New to Data Viz.html">01. New to Data Viz?</a>
    </li>
    <li class="">
      <a href="02. Video What is Tableau.html">02. Video: What is Tableau?</a>
    </li>
    <li class="">
      <a href="03. Text Installing Tableau.html">03. Text: Installing Tableau</a>
    </li>
    <li class="">
      <a href="04. Video How This Lesson Is Structured.html">04. Video: How This Lesson Is Structured?</a>
    </li>
    <li class="">
      <a href="05. Text Outline of Topics Covered.html">05. Text: Outline of Topics Covered</a>
    </li>
    <li class="">
      <a href="06. Commas vs Periods.html">06. Commas vs Periods</a>
    </li>
    <li class="">
      <a href="07. Video Connecting to Data.html">07. Video: Connecting to Data</a>
    </li>
    <li class="">
      <a href="08. Text Connecting to Data Recap.html">08. Text: Connecting to Data Recap</a>
    </li>
    <li class="">
      <a href="09. Quiz Connecting to Data.html">09. Quiz: Connecting to Data</a>
    </li>
    <li class="">
      <a href="10. Video Combining Data.html">10. Video: Combining Data</a>
    </li>
    <li class="">
      <a href="11. Text Combining Data Recap.html">11. Text: Combining Data Recap</a>
    </li>
    <li class="">
      <a href="12. Quiz Combining Data.html">12. Quiz: Combining Data</a>
    </li>
    <li class="">
      <a href="13. Video What Can You Create In Tableau.html">13. Video: What Can You Create In Tableau?</a>
    </li>
    <li class="">
      <a href="14. Video Worksheets.html">14. Video: Worksheets</a>
    </li>
    <li class="">
      <a href="15. Text Worksheets.html">15. Text: Worksheets</a>
    </li>
    <li class="">
      <a href="16. Quiz Worksheets.html">16. Quiz: Worksheets</a>
    </li>
    <li class="">
      <a href="17. Text Saving to Tableau Public.html">17. Text: Saving to Tableau Public</a>
    </li>
    <li class="">
      <a href="18. Video Aggregations.html">18. Video: Aggregations</a>
    </li>
    <li class="">
      <a href="19. Text Aggregations.html">19. Text: Aggregations</a>
    </li>
    <li class="">
      <a href="20. Quiz Aggregations.html">20. Quiz: Aggregations</a>
    </li>
    <li class="">
      <a href="21. Video Hierarchies.html">21. Video: Hierarchies</a>
    </li>
    <li class="">
      <a href="22. Text Hierarchies.html">22. Text: Hierarchies</a>
    </li>
    <li class="">
      <a href="23. Quiz Hierarchies.html">23. Quiz: Hierarchies</a>
    </li>
    <li class="">
      <a href="24. Video Marks &amp; Filters.html">24. Video: Marks &amp; Filters</a>
    </li>
    <li class="">
      <a href="25. Text Marks &amp; Filters I.html">25. Text: Marks &amp; Filters I</a>
    </li>
    <li class="">
      <a href="26. Quiz Marks &amp; Filters I.html">26. Quiz: Marks &amp; Filters I</a>
    </li>
    <li class="">
      <a href="27. Text Marks &amp; Filters II.html">27. Text: Marks &amp; Filters II</a>
    </li>
    <li class="">
      <a href="28. Quiz Marks &amp; Filters II.html">28. Quiz: Marks &amp; Filters II</a>
    </li>
    <li class="">
      <a href="29. Video Show Me.html">29. Video: Show Me</a>
    </li>
    <li class="">
      <a href="30. Text Show Me.html">30. Text: Show Me</a>
    </li>
    <li class="">
      <a href="31. Quiz Show Me.html">31. Quiz: Show Me</a>
    </li>
    <li class="">
      <a href="32. Video Small Multiples &amp; Dual Axis.html">32. Video: Small Multiples &amp; Dual Axis</a>
    </li>
    <li class="">
      <a href="33. Text Small Multiples &amp; Dual Axis.html">33. Text: Small Multiples &amp; Dual Axis</a>
    </li>
    <li class="">
      <a href="34. Text Map Configuration.html">34. Text: Map Configuration</a>
    </li>
    <li class="">
      <a href="35. Quiz Small Multiples.html">35. Quiz: Small Multiples</a>
    </li>
    <li class="">
      <a href="36. Quiz Dual Axis.html">36. Quiz: Dual Axis</a>
    </li>
    <li class="">
      <a href="37. Video Groups &amp; Sets.html">37. Video: Groups &amp; Sets</a>
    </li>
    <li class="">
      <a href="38. Text Groups &amp; Sets.html">38. Text: Groups &amp; Sets</a>
    </li>
    <li class="">
      <a href="39. Quiz Groups.html">39. Quiz: Groups</a>
    </li>
    <li class="">
      <a href="40. Quiz Sets.html">40. Quiz: Sets</a>
    </li>
    <li class="">
      <a href="41. Video Calculated Fields.html">41. Video: Calculated Fields</a>
    </li>
    <li class="">
      <a href="42. Text Calculated Fields.html">42. Text: Calculated Fields</a>
    </li>
    <li class="">
      <a href="43. Quiz Calculated Fields.html">43. Quiz: Calculated Fields</a>
    </li>
    <li class="">
      <a href="44. Video Table Calculations.html">44. Video: Table Calculations</a>
    </li>
    <li class="">
      <a href="45. Text Table Calculations.html">45. Text: Table Calculations</a>
    </li>
    <li class="">
      <a href="46. Quiz Table Calculations.html">46. Quiz: Table Calculations</a>
    </li>
    <li class="">
      <a href="47. Text Recap.html">47. Text: Recap</a>
    </li>
    <li class="">
      <a href="48. Video What&#x27;s Next.html">48. Video: What&#x27;s Next?</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>
</nav>

    <div id="content">
      <header class="container-fluild header">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="align-items-middle">
                <button type="button" id="sidebarCollapse" class="btn btn-toggle-sidebar">
                  <div></div>
                  <div></div>
                  <div></div>
                </button>

                <h1 style="display: inline-block">42. Text: Calculated Fields</h1>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div class="row">
          <div class="col-12">
            <div class="ud-atom">
  <h3></h3>
  <div>
  <h1 id="text-for-previous-video-on-calculated-fields">Text for Previous Video on Calculated Fields</h1>
<h1 id="calculated-fields">Calculated fields</h1>
<p>There will be times when you want to look at something but there isn't a specific field for it. For instance, maybe you want to know the profit per item for each order record. It seems pretty simple, just divide profit by order for each record, then aggregate it, but how do you actually do the division in Tableau?</p>
<p>The answer is <strong>calculated fields</strong>. Calculated fields let you create new fields to use in your visualizations. If you have experience working with formulas in Excel, creating calculated fields should feel pretty similar.</p>
<p>To create a calculated field, open the menu on a field (such as <strong>Profit</strong>), then Create &gt; Calculated Field…. (See below). You can also create one by clicking on "Analysis" in the top menu bar, then selected "Create Calculated Field…"</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/calculated-field-from-field-menu.png" alt="" class="img img-fluid">
    <figcaption class="figure-caption">
      
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>You should see the editor:</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/calculated-field-panel.png" alt="" class="img img-fluid">
    <figcaption class="figure-caption">
      
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>If you don't see the functions panel, click on the little triangle on the right edge of the editor.</p>
<p>Fields in the editor show up in brackets, like <code>[Profit]</code>. You can do simple arithmetic here, like adding a constant, or multiplying the field. You can also use functions such as absolute value, sine, square root, etc. If you want to make a field all positive, you'd do <code>ABS([Profit])</code>. There is a list of functions on the right and some short documentation is shown when you select one.</p>
<p>Here we want to create a new field that calculates the profit per item for each record. It's pretty simple, just <code>[Profit]/[Quantity]</code> which I've done below. I also renamed the calculated field to "Profit per item".</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/calculated-field-.png" alt="" class="img img-fluid">
    <figcaption class="figure-caption">
      
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>Once you hit "OK" and create it, the new field shows up in the data pane. You can use it just like any other field. I made a plot of the average profit per item for each sub-category.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/calculated-profit-per-item.png" alt="" class="img img-fluid">
    <figcaption class="figure-caption">
      
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>You can see the <strong>Profit per item</strong> field on the left. The little equals sign <code>=#</code> next to the name means it is a calculated field. Now this field has the profit per item for each record. We want to know the average profit per item for each sub-category, so drag it to Columns and do an average aggregation.</p>
<h2 id="aggregation-in-calculated-fields">Aggregation in Calculated Fields</h2>
<p>You can also do aggregation directly in a calculated field. For instance, we can also calculate the profit per item by <code>SUM([Profit])/SUM([Quantity])</code>. The <code>SUM()</code> functions are aggregations just like you do with fields in views.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/calculated-aggregation.png" alt="" class="img img-fluid">
    <figcaption class="figure-caption">
      
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>The two methods for calculating the profit per item look basically the same, but there are some discrepancies like in "Tables". I'm going to look at this a little closer so you can see how Tableau works a bit better.</p>
<p>If I expand the table to products…</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/calculated-aggregation-products.png" alt="" class="img img-fluid">
    <figcaption class="figure-caption">
      
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>Now we see there are some weird things going on. A lot of the results from the two methods are extremely different. The third product has a profit per item of $9 or -$5. Looking at the values of Profit and Quantity, it appears that the aggregation method (<code>SUM([Profit])/SUM([Quantity]</code>) is doing the right thing. I'll dig down to individual records to see what's happening.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <figure class="figure">
    <img src="img/calculated-field-rows.png" alt="" class="img img-fluid">
    <figcaption class="figure-caption">
      
    </figcaption>
  </figure>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>At the row level, the two calculations are the same. It's the averaging of the [Profit]/[Quantity] calculation that is causing the difference. For the the "Atlantic Mobile 4-Shelf Bookcases" product, all the ratios are correct. But when you average them, (28-112+28+42+28+42)/6 = 9.333, you get what we see at the product name level. </p>
<p>The aggregation in the other calculation takes care of that for us. It always calculates the ratios for the level of granularity we're at. You can see the columns <code>Profit</code> and <code>Quantity</code> doing the summation at the level of granularity and the ratio <code>SUM([Profit])/SUM([Quantity])</code> is taken from those numbers.</p>
<p>The two calculations are answering different questions. </p>
<ol>
<li><p>What is the profit ratio for a <em>single order</em> within any product or any other category level?</p>
<ul>
<li>Use Average <code>[Profit]/[Quantity]</code> </li></ul></li>
<li><p>What is the profit ratio at any level of a category?</p>
<ul>
<li>Use <code>SUM([Profit])/SUM([Quantity])</code></li></ul></li>
</ol>
<p>It's important to make sure you are answering the right question when working with data! </p>
<h2 id="conditional-statements">Conditional statements</h2>
<p>As in Excel and most programming languages, you can use conditional statements like <code>IF</code>, <code>THEN</code>, <code>ELSE</code> in calculations. For example to make a new field to categorize sales as "good" and bad", you could do:</p>
<p><code>IF SUM([Sales]) &gt; 10000 THEN "Good" ELSE "Bad"</code></p>
<p>You'll use this pattern a lot, there is a short hand version with the function <code>IIF</code>. The function works like <code>IIF(conditions, if true, if false)</code></p>
<p><code>IIF(SUM([Sales]) &gt; 10000, "Good", "Bad")</code></p>
<h2 id="calculations-with-strings">Calculations with strings</h2>
<p>Much of the time you'll find yourself working with strings (text) like the product names in this data set. In calculations, you can do things like split up words in a string, find words in a string, and concatenate strings.</p>
<p>Here's a great <a href="http://www.tableau.com/learn/tutorials/on-demand/string-calculations" rel="noopener noreferrer" target="_blank">tutorial video from Tableau</a> and <a href="http://www.clearlyandsimply.com/clearly_and_simply/2014/06/string-calculations-in-tableau.html" rel="noopener noreferrer" target="_blank">a blog post</a> with a bunch of in depth examples.</p>
<h2 id="more-on-calculated-fields">More on calculated fields</h2>
<p>There is a lot to learn about calculate fields that's outside the scope of this lesson. If you want to know more about calculated fields, the <a href="https://onlinehelp.tableau.com/current/pro/desktop/en-us/calculations_calculatedfields.html" rel="noopener noreferrer" target="_blank">Tableau documentation</a> is a great place to start. As you're working with Tableau, be sure to visit the documentation often.</p>
</div>

</div>
<div class="divider"></div>
          </div>

          <div class="col-12">
            <p class="text-right">
              <a href="43. Quiz Calculated Fields.html" class="btn btn-outline-primary mt-4" role="button">Next Concept</a>
            </p>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <p class="text-center">
                <a href="https://us-udacity.github.io/" target="_blank">【udacity2.0 】If you need more courses, please add wechat：udacity6</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>


  <script src="../assets/js/jquery-3.3.1.min.js"></script>
  <script src="../assets/js/plyr.polyfilled.min.js"></script>
  <script src="../assets/js/bootstrap.min.js"></script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/js/katex.min.js"></script>
  <script>
    // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('42. Text: Calculated Fields')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
</body>

</html>
